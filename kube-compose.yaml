apiVersion: v1
kind: ReplicationController
metadata: 
  name: phpinfo-rc
spec:
  replicas: 2
  selector: 
    app: phpinfo
    branch: santander
  template:
    metadata: 
      labels: 
        app: phpinfo
        branch: santander
    spec: 
      initContainers:
        - 
          args: 
            - -c 
            - test -f index.php || wget https://raw.githubusercontent.com/JoseMgil/phpinfo/santander/src/index.php 
          command:
            - /bin/sh
          env: 
            - 
              name: author
              value: Josemiguel
            - 
              name: JAVA_HOME
              value: /var/lib/java
          image: library/busybox:latest
          name: phpinfo-init-container
          volumeMounts: 
            - 
              mountPath: /src/
              name: phpinfo-volume
              readOnly: false
          workingDir: /src/
      containers:
        - 
          args: 
            - -f 
            - src/index.php
            - -S 
            - 0.0.0.0:8080
          command:
            - /usr/bin/php
          env: 
            - 
              name: author
              value: Josemiguel
            - 
              name: JAVA_HOME
              value: /var/lib/java
          image: manyogil/phpinfo:santander
          name: phpinfo-container
          ports: 
            -  
              containerPort: 8080
              protocol: TCP
          volumeMounts: 
            - 
              mountPath: /src/index.php
              name: phpinfo-volume
              readOnly: true
              subPath: index.php
      volumes: 
        - 
          persistentVolumeClaim:
            claimName: phpinfo-pvc
            readOnly: false            
          name: phpinfo-volume
---
apiVersion: v1
kind: Service
metadata: 
  name: phpinfo-svc
spec:
  clusterIP: ''
  ports: 
    - 
      port: 80
      protocol: TCP 
      targetPort: 8080
  selector:
    app: phpinfo
    branch: santander
  type: ClusterIP
---
apiVersion: v1
kind: persistentVolumeClaim
metadata: 
  name: phpinfo-pvc
spec:
  accessModes: 
    - ReadWriteOnce
  resources: 
    limits: 
      storage: 1M
    requests: 
      storage: 1M
  storageClassName: gp2
  
  
